{{extend 'layout.html'}}
<h2>Search {{=searchType}}</h2>
<h5 align = "right"> {{=form}}</h5>


<table class="table">
    <tr>
        <th>Title</th>
        <th>Author</th>
        <th>Permission to add line</th>
        <th>First Line</th>
    </tr>
    {{for row in rows :}}
        {{match = False}}
        {{for i, check in enumerate(row.title.split()):}}
            {{if row.title.split()[i].lower() == searchKey.lower() and searchType == 'Poems':}}
                {{match = True}}
            {{pass}}
        {{pass}}
        {{for i, check in enumerate(db.auth_user(row.author).username.split()):}}
            {{if db.auth_user(row.author).username.split()[i].lower() == searchKey.lower() and searchType == 'Authors':}}
                {{match = True}}
            {{pass}}
        {{pass}}
    <tr>
        {{if  match == True and searchType == 'Poems':}}
            <td><a href="{{=URL('poem',args=row.id)}}">{{=row.title}}</td>
            <td>{{=db.auth_user(row.author).username}}</td>
            <td>{{=row.permission}}</td>
            <td>{{=row.body.split('\n')[0]}}</td>
        {{elif match == True and searchType == 'Authors':}}
            <td><a href="{{=URL('poem',args=row.id)}}">{{=row.title}}</td>
            <td>{{=db.auth_user(row.author).username}}</td>
            <td>{{=row.permission}}</td>
            <td>{{=row.body.split('\n')[0]}}</td>
    </tr>
        {{pass}}
    {{pass}}
</table>
