{{extend 'layout.html'}}
{{ if poem.permission == 'Private':}}
    {{allow = False}}
    {{for permission in db(db.permission).select():}}
        {{if permission.poem_id == poem.id and permission.user_id.username == auth.user.username:}}
            <h2>{{=poem.title}}</h2>
            </br>
            <pre>{{=poem.body}}</pre>
            Author: {{=db.auth_user(poem.author).username}}
            </br>
            <h2>Add a line to this poem</h2>
            {{=form}}
            {{allow = True}}
    {{pass}}
    {{pass}}

    {{if allow == False:}} <h2>Access Denied</h2> {{pass}}

{{else:}}
<h2>{{=poem.title}}</h2>
            </br>
            <pre> {{=poem.body}} </pre>
            Author: {{=db.auth_user(poem.author).username}}
            </br>
            <h2>Add a line to this poem</h2>
            {{=form}}
{{pass}}

<form action="javascript:RhymeBrainSubmit()">
    <input type=text id="RhymeBrainInput">
    <input type=submit value="Rhyme">
</form>
<script type="text/javascript">
    var RhymeBrainMaxResults = 50;
</script>
<script type="text/javascript" src="http://rhymebrain.com/external.js"></script>
Rhyme results are provided by <a href="http://rhymebrain.com">RhymeBrain.com</a>
